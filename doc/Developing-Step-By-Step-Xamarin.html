<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
<link type="text/css" rel="stylesheet" href="bootstrap.min.css" />
<title>Developing an Application Step By Step</title>
<style type="text/css">
.auto-style2 {
	background-color: #FFFF00;
}
</style>
</head>

<body>

<h3>Introduction</h3>

<p>In this document, we will develop a sample <strong>Xamarin Phonebook 
Application</strong> step by step integrated with ASP.NET Zero website.</p>
 
 <div>
 
 </div>
 
 
<div class="bs-callout bs-callout-warning">
	<i class="fa fa-exclamation-triangle"></i> The Asp.Net Zero Xamarin is only available for 
	<strong>Asp.Net Core</strong> version including Angular UI and Mvc UI.</div>
</div>



<h3>Opening Solution</h3>
<p>This is the follow-up of the <a href="Developing-Step-By-Step-Core.html">
Developing Step By Step Phonebook</a> documentation! In the
<a href="Developing-Step-By-Step-Core.html">previous document</a> we&#39;ve completed how to create a phonebook on 
server side and web client. To start Xamarin developlent download the solution
<strong>
<a href="https://github.com/aspnetzero/aspnet-zero-samples/tree/master/PhoneBook-Core">
Acme.PhoneBookDemo</a> </strong>
and open the <b>Acme.PhoneBookDemo.Mobile.sln</b> or <b>Acme.PhoneBookDemo.All.sln.</b></p>


<div class="bs-callout bs-callout-info">
	<strong><i class="fa fa-info-circle"></i> Mobile Development Device</strong>
	<div>Before you start development, it is recommended to choose a device. You can start with iPhone simulator, Android emulator or with a real device. In this example we used the Android emulator with the below specs;
<div>Nexus 6 (5.96 inches) + Android 7.1.1 + API Level 25 +  Google APIs Intel Atom (x86_64)</div>
	</div>
</div>
  



<h3>Configuration</h3>
<p>It is imported to set <strong>LocalhostIp </strong>to communicate the mobile 
device with server. <strong>LocalhostIp</strong> is the address of your server. 
If you are hosting Web Api in your computer then set it your computer network 
address. </p>

<img class="img-thumbnail" alt="Configuring Host Address" src="images/xamarin-phonebook-my-local-ip.png" />
<p>If you are using an emulator you can use the <strong>emulator&#39;s loopback 
address</strong> to reach your local computer. Eg: for Android emulator, it&#39;s <strong>
10.0.2.2</strong></p>
<img class="img-thumbnail" alt="Configuring Host Address for Android Emulator" src="images/xamarin-phonebook-android-emulator-ip.png" /> 





<h3>Hosting Web Api</h3>
<p>You can use<strong> Acme.PhoneBookDemo.Web.Host </strong>or <strong>
Acme.PhoneBookDemo.Web.Mvc</strong> as your Web Api. In this example we'll use
<strong>Acme.PhoneBookDemo.Web.Host </strong>as our host. To start publishing 
host follow the below steps;</p>
<ul>
	<li>Open command prompt (<strong>cmd</strong>)</li>
	<li>Change directory to <strong>
	\aspnet-zero-samples\PhoneBook-Core\src\Acme.PhoneBookDemo.Web.Host</strong></li>
	<li>Run the below lines one by one<ul>
		<li><span class="auto-style2">SET ASPNETCORE_URLS=</span><a href="http://*:22742" class="auto-style2">http://*:22742</a></li>
		<li><span class="auto-style2">dotnet run</span ></li>
	</ul>
	</li>
</ul>

<img class="img-thumbnail" alt="Starting Host Wep Api" src="images/xamarin-phonebook-start-host.png" />

<div class="bs-callout bs-callout-info">
	<strong><i class="fa fa-info-circle"></i></strong> Before you start development, it is adviced to 
	run the current (out of the box) Xamarin app to see if you can successfully establish the connection between emulator and host Web Api.
</div>


<h3>Creating Application Service Client</h3>
<p>To consume host Web Api methods we need to implement the <b>IPersonAppService</b> 
application service. Create a new folder called <b>
PhoneBook</b> in <b>
Acme.PhoneBookDemo.Application.Client</b> project.</p>
<p>Then create a new class called <b>ProxyPersonAppService </b>in the <b>
PhoneBook </b>folder. Inherit <strong>ProxyPersonAppService</strong> class from <b>ProxyAppServiceBase</b>,
<b>IPersonAppService</b> base. Visual Studio will help us to add all 
unimplemented methods from <strong>IPersonAppService</strong> at once.</p>
<p>Add <b>async</b> keyword to all methods to be able to benefit multi-tasking.</p>

<img class="img-thumbnail" alt="Creating Person App Service Client" src="images/xamarin-phonebook-person-app-service-client.png" />
<h4>Implementing App Service Methods</h4>
<p>In the <strong>ProxyAppServiceBase</strong> class you&#39;ll see <i>ApiClient</i> which is being 
used to call host Web Api methods. We&#39;ll use <i>ApiClient</i> to transfer data with host.
ApiClient has <b>post, put, get, delete </b>http methods. To decide which 
needs to be called for the corresponding method you can read
<a href="https://aspnetboilerplate.com/Pages/Documents/AspNet-Core#application-services-as-controllers">
Asp.Net Boilerplate Application Services as Controllers</a> document.
To summarize that document; Asp.Net Boilerplate framework uses <strong>
ConventionalHttpVerbs </strong>by default.<strong> </strong>This means there&#39;s a 
naming convention while implementing app service methods. </p>


<div class="bs-callout bs-callout-info">
	<strong><i class="fa fa-info-circle"></i> About Naming Convention</strong>
	<div>When method name starts with;</div>
	<ul>
		<li><b>Get</b> =&gt; ApiClient.GetAsync&lt;T&gt;(...);</li>
		<li><b>Put or Update</b> =&gt; ApiClient.PutAsync&lt;T&gt;(...);</li>
		<li><b>Delete or Remove</b> =&gt; ApiClient.DeleteAsync&lt;T&gt;(...);</li>
		<li><b>Post, Create or Insert </b>=&gt; ApiClient.PostAync&lt;T&gt;();</li>
		<li><b>If none of the above</b> =&gt; Post is used as default.</li>
	</ul>
</div>
  
<p>Based on the above information we will implement the methods.The first method 
is <b>GetPeople</b>, it starts with <b>Get</b> prefix, so we have to use <i>
ApiClient.GetAsync(...)</i> method.</p>
<p><b>GetEndPoint() </b> method adds the executing method name to the url. The 
application service method name is part of the Web Api url.</p>
<pre lang="cs">
public async Task&lt;ListResultDto&lt;PersonListDto&gt;&gt; GetPeople(GetPeopleInput input)
{
    return await ApiClient.GetAsync&lt;ListResultDto&lt;PersonListDto&gt;&gt;(GetEndpoint(nameof(GetPeople)), input);
}</pre>
<p>Do the same for other methods.<span id="result_box" class="short_text" lang="en">The 
final view of <b>ProxyPersonAppService</b> class should be like this;</span></p>
<pre lang="cs">public class ProxyPersonAppService : ProxyAppServiceBase, IPersonAppService
{
    public async Task&lt;ListResultDto&lt;PersonListDto&gt;&gt; GetPeople(GetPeopleInput input)
    {
        return await ApiClient.GetAsync&lt;ListResultDto&lt;PersonListDto&gt;&gt;(GetEndpoint(nameof(GetPeople)), input);
    }

    public async Task CreatePerson(CreatePersonInput input)
    {
        await ApiClient.PostAync(GetEndpoint(nameof(CreatePerson)), input);
    }

    public async Task DeletePerson(EntityDto input)
    {
        await ApiClient.DeleteAsync(GetEndpoint(nameof(DeletePerson)), input);
    }

    public async Task DeletePhone(EntityDto&lt;long&gt; input)
    {
        await ApiClient.DeleteAsync(GetEndpoint(nameof(DeletePhone)), input);
    }

    public async Task&lt;PhoneInPersonListDto&gt; AddPhone(AddPhoneInput input)
    {
        return await ApiClient.PostAync&lt;PhoneInPersonListDto&gt;(GetEndpoint(nameof(AddPhone)), input);
    }

    public async Task EditPerson(EditPersonInput input)
    {
        await ApiClient.PostAync(GetEndpoint(nameof(EditPerson)), input);
    }

    public async Task&lt;GetPersonForEditOutput&gt; GetPersonForEdit(IEntityDto input)
    {
        return await ApiClient.GetAsync&lt;GetPersonForEditOutput&gt;(GetEndpoint(nameof(GetPersonForEdit)), input);
    }
}
</pre>
<p>When we complete the communication phase we can start 
to create person and person details view for mobile. </p>
<div class="bs-callout bs-callout-info">
	<strong><i class="fa fa-info-circle"></i></strong> Note that &quot;<b>Page</b>&quot; and &quot;<b>View</b>&quot; words are used for same 
	the meaning and 
purposed for pointing <b>XAML</b> files.
</div>

<p>We&#39;ll create views first, then view-models. Let&#39;s create <b>PeopleView.xaml</b>...</p>
<h3>Creating People Page</h3>
<p>PeopleView is going to list all the persons. When we tap one of the person 
we&#39;ll navigate to person details. The person details page will contain personal 
information and phone numbers of person.<br>
In <b>Acme.PhoneBookDemo.Mobile.Shared </b>project, there&#39;s <b>Views</b> 
folder. All the pages must be located in <b>Views</b> folder.</p>
<h4>Creating PeopleView</h4>

<p>You can create a new empty <b>Content Page </b>as below but in this example 
we&#39;ll copy and paste 
<b>_SampleView.xaml</b> file as a template.</p>

<img class="img-thumbnail" alt="Adding New Content Page" src="images/xamarin-phonebook-add-contentpage.png"/>

<p>&nbsp;</p>
<p>Copy and paste <b>_SampleView.xaml</b> into the same folder. We&#39;ll rename the 
file. All the views <u>must</u> end with<b> &quot;<u>View</u>&quot;</b> postfix. This is 
mandatory for auto matching related view model. So rename <b>_SampleView - 
Copy.xaml</b> to&nbsp; <b>PeopleView.xaml.</b></p>
<p>After copy/paste you have to rename the followings for PeopleView.xaml as 
well</p>
<ul>
	<li><b>The class name in xaml:</b>&nbsp; 
	x:Class=&quot;Acme.PhoneBookDemo.Views._SampleView&quot; <b>
	<font size="4" color="#808080">»</font></b> 
	x:Class=&quot;Acme.PhoneBookDemo.Views.PeopleView&quot;</li>
	<li><b>The class name in xaml.cs:</b> public partial class _SampleView <b><font size="4" color="#808080">
	»</font></b> 
	public partial class PeopleView</li>
	<li><b>The constructor of xaml.cs:</b> public _SampleView() <b><font size="4" color="#808080">
	»</font></b> 
	public PeopleView() </li>
</ul><p>
<img class="img-thumbnail" alt="Creating Person App Service Client" src="images/xamarin-phonebook-copy-paste-sample-view-to-people-view.png"/></p>
<p>
We have created an empty view. 
Let's add a title to this page! </p>
 
	 
	<p>Add the highlighted code in <b>&lt;ContentPage&gt;</b> tag like below;</p>
	<pre>&lt;ContentPage
 ...
<span style="background-color: #FFFF00">xmlns:extensions=&quot;clr-namespace:Acme.PhoneBookDemo.Extensions.MarkupExtensions;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;
 Title=&quot;{extensions:Translate PhoneBook}&quot;</span>
 ...&gt;</pre>
 

<ul>
	<li><strong>xmlns:extensions</strong> imports the namespace <strong>
	Acme.PhoneBookDemo.Extension.MarkupExtensions.</strong></li>
	<li><strong>Title</strong> sets page title with localization. In views you 
	can localize texts with <strong>TranslateExtension</strong> class which is a 
	markup extension. There's a naming convention in markup extensions. You 
	don't use <em>Extension</em> postfix when you are using the markup. For example for
	<strong>TranslateExtension</strong> we just use <strong>Translate</strong>. And 
	we pass 
	the translation key after a space.</li>
</ul>
	<p>
To control this view we have to create view-model for this view. Next step 
	is creating view-model <strong>PeopleViewModel</strong>...</p>
<h4>Creating PeopleViewModel</h4>
<p>Asp.Net Zero Xamarin app uses 
<a href="https://developer.xamarin.com/guides/xamarin-forms/enterprise-application-patterns/mvvm/">
MVVM</a> 
pattern. So each view should have a view-model. According to conventional 
view-model binding, view-model file names <u>must</u> end with <b>
&quot;<u>ViewModel</u>&quot;</b> postfix. Otherwise it'll not work! So the view-model name for <i>PeopleView</i> must be <b>PeopleViewModel</b>. 
All view models <u>must</u> be located in <b>ViewModels</b> folder. This is 
mandatory as well!</p>
<p>You can create a new class called <b>PeopleViewModel</b> in <b>ViewModels</b> 
folder. But as we did for the view we&#39;ll use the empy template view-model called <b>
_SampleViewModel.cs.</b></p>
<p>Copy and paste <b>_SampleViewModel.cs</b> and rename the followings;</p>
<ul>
	<li><b>The view-model filename:</b> _SampleViewModel - Copy.cs <b><font size="4" color="#808080">
	»</font></b> 
	PeopleViewModel.cs</li>
	<li><b>The constructor of view-model:</b> public class _SampleViewModel : 
	XamarinViewModel <b><font size="4" color="#808080">»</font></b> 
	public class PeopleViewModel : XamarinViewModel</li>
</ul>
<p>Thus far we have implemented the proxy class for <i>PersonAppService</i>, 
created
<i>People</i> view and created view-model <i>PeopleViewModel</i>.</p>
<p>To be able to see the new page in the app, there&#39;s one more thing to do... 
Adding this page to the navigation menu.</p>
<h4>Adding PeopleView to Navigation Menu</h4>
<p>To add a new menu item, open <b>MenuProvider</b> class in <b>
Acme.PhoneBookDemo.Mobile.Shared </b>project. The navigation menu items are 
stored in a 
<a href="https://developer.xamarin.com/api/type/System.Collections.ObjectModel.ObservableCollection`1/">
ObservableRangeCollection</a>. This is for notifying view whenever an item 
changes in the collection. Add the new <i>NavigationMenuItem</i> in the list like below;</p>
<pre lang="cs">
public class MenuProvider : ISingletonDependency, IMenuProvider
{
	private readonly ObservableRangeCollection&lt;NavigationMenuItem&gt; _menuItems = new ObservableRangeCollection&lt;NavigationMenuItem&gt;
	{
		new NavigationMenuItem
		{
			Title = L.Localize(&quot;Tenants&quot;),
			Icon = &quot;Tenants.png&quot;,
			ViewType = typeof(TenantsView),
			RequiredPermissionName = PermissionKey.Tenants,
		},
		new NavigationMenuItem
		{
			Title = L.Localize(&quot;Users&quot;),
			Icon = &quot;UserList.png&quot;,
			ViewType = typeof(UsersView),
			RequiredPermissionName = PermissionKey.Users,
		},
<span style="background-color: #FFFF00">		new NavigationMenuItem
		{
			Title = L.Localize(&quot;PhoneBook&quot;),
			Icon = &quot;ic_contact_phone_black_24dp.png&quot;,
			ViewType = typeof(PeopleView),
			RequiredPermissionName = PermissionKey.Phonebook
		}</span>
		...
 };

</pre> 
<p>Let&#39;s set the properties of the new <i>NavigationMenuItem</i>;</p>

<ol>
	<li><strong>Title:</strong> It&#39;s already localized in the <a href="Developing-Step-By-Step-Core.html">
	Developing Step By Step Phonebook</a> documentation. We just set 
	localization key with<i> </i>this shortcut:<b><i> </i>
	L.Localize(&quot;PhoneBook&quot;).</b> 
	And it localizes menu text.</li>
		<li><strong>Icon:</strong> Download a related png icon file. For this 
		example go to <a href="https://material.io/icons/#ic_contact_phone">
		https://material.io/icons/#ic_contact_phone</a> and download PNGS. Then 
		extract the download zip file. 
		You can use<i> 
		ic_contact_phone_black_24dp\android\drawable-xxhdpi\ic_contact_phone_black_24dp.png</i> 
		as the icon.<br/>
		Copy and paste the file into <b>UI\Assets\Images </b>folder in the <b>
		Acme.PhoneBookDemo.Mobile.Shared</b> project. <br/>
		Right click the png file and go to properties. In the <b>
		Advanced<span style="font-weight: 400"> </span></b>section set <b>Build 
		Action</b> as <u> <b>Embedded resource</b></u>.<br/>
 		This is mandatory! This will help to share the icon file across 
		platforms.<br/>
		Now set Icon property of <i>NavigationMenuItem</i> to <b>
		&quot;ic_contact_phone_black_24dp.png&quot;</b><br/>
  <img class="img-thumbnail" alt="Add PhoneBook Menu Item to Menu" src="images/xamarin-phonebook-set-menu-icon-as-embedded-resource.png"/>
		
		</li>
</ol>



<ol>
	<li><strong>ViewType:</strong> Must be the class name of the view in the 
	<b>View</b> folder. The view name is <i>PeopleView</i> let&#39;s set view type 
	to <b>
	typeof(PeopleView).</b></li>
	<li><strong>RequiredPermissioName:</strong> A permission key has to be 
	assigned to be able to show/hide the new menu according to the user&#39;s 
	permission. In the previous document it&#39;s already declared in &quot;<a href="https://www.aspnetzero.com/Documents/Developing-Step-By-Step-Core#define-the-permission">Define 
	the permission</a>&quot; section as &quot;<b>Pages.Tenant.PhoneBook</b>&quot;. We need to 
	use the same string for permission key. So what you have to do is add the 
	below line to <b>PermissionKey</b> class like below;
	 <pre lang="cs">public const string Phonebook = &quot;Pages.Tenant.PhoneBook&quot;;</pre>
<img class="img-thumbnail" alt="Adding PhoneBook Permission" src="images/xamarin-phonebook-add-permission-key.png"/>	
	</li>	
</ol>
<p>Let&#39;s run the application to see the new menu item. In this example we&#39;ll use 
Android platform to test the sample. Hence set the startup project to <b>
Acme.PhoneBookDemo.Mobile.Droid</b>. If you&#39;ve already started Android emulator, you can directly run the project. 
But if you&#39;ve not started the emulator yet, it&#39;s adviced to you to start the 
emulator first from the Visual Studio Toolbar like shown below... The reason of 
initializing emulator is; sometimes Visual Studio cannot make initial connection 
to the emulator for the first run. So it&#39;s better to run it and wait until it 
starts up successfully. When you see the emulator home screen, you can run the 
project (F5).</p>
 
<img class="img-thumbnail" alt="Adding PhoneBook Permission" src="images/xamarin-phonebook-start-emulator.png"/>	

<p>You will see a splash screen while initializing. After that you&#39;ll see the 
app login page. The PhoneBook is defined on tenant side. You have to switch to a 
tenant to see the PhoneBook menu item. On the right top of the screen there&#39;s a 
toolbar button called <b>Change Tenant</b>. Tab that button and enter <b>default </b>
into the textbox. If the tenant <b>
default</b>&nbsp;is available you will see <b>&quot;Current Tenant: default&quot;</b> label. If 
the tenant is not active or does not exist then you&#39;ll get an alert about that.</p>
 
<img class="img-thumbnail" alt="Adding PhoneBook Permission" src="images/xamarin-phonebook-android-emulator-login-screen.png"/>

<p>Enter your credentials (<em>admin:123qwe</em>) and tap <b>Log In</b> button. If you see an alert says 
&quot;<i>You must change your password before logging on!</i>&quot;&nbsp; you need to 
login and change your password for the first time on the website. (Currently 
Xamarin app doesn&#39;t have password change screen and will be added in the next 
releases.) When you successfully login, you can see the below screen with new <b>Phone 
book</b> menu item.</p>

<img class="img-thumbnail" alt="Adding PhoneBook Permission" src="images/xamarin-phonebook-empty-phonebook.png"/>

<p>Up to here we successfully added an empty People page. Let&#39;s populate the 
view with data...</p>
<h4>Populating PeopleView with Data</h4>
<p>The first function is listing people in PeopleView. To list repeating items 
we use
<a href="https://developer.xamarin.com/guides/xamarin-forms/user-interface/listview/">
ListView</a>. Open 
<b>PeopleView.xaml</b> and set title of the view;</p>
<h5>Creating Model</h5>

<p>In the <b>PeopleView</b> we will use a model to list people .The <b>ProxyPersonAppService 
&gt; GetPeople() </b>method returns <b>
ListResultDto&lt;PersonListDto&gt;.</b> It is not conveniant to directly use the DTO 
object from server. The main reason is DTO doesn&#39;t implement <b>
INotifyPropertyChanged</b> interface. To overcome this issue, we create a new 
mapping class. This mapping class is used to name as Model. Additional advantage 
of this model class is, you can add extra properties to use in your view. 
Forexample you can add FullName that combines name and surname. This increases 
app performance by rendering less elements. So let&#39;s define the <b>
PersonListModel</b> class. Create a new folder called <strong>PhoneBook</strong> in 
<strong>Models</strong> folder of <b>
Acme.PhoneBookDemo.Mobile.Shared</b> project. Add a a new class <b>
PersonListModel.cs</b> into that folder.&nbsp;Not to add all 
properties from the <b>
PersonListDto</b> class, inherit the model class from <b>
PersonListDto</b> . We'll need the full name of the person to use in view, that&#39;s why 
we add a new property 
called <b>FullName</b> that joins <i>Name</i> and <i>
Surname</i>. Additionally add a <b>[AutoMapFrom(typeof(PersonListDto))]</b> 
attribute to map <i>
PersonListDto</i> to <i>PersonListModel</i>. Then add <b>Phones</b> property 
with type <b>ObservableRangeCollection&lt;PhoneInPersonListDto&gt;. </b>As there&#39;s 
Phones property in PersonListDto add <b>new </b>keyword to the property. The 
complete definition of <b>PersonListModel</b> 
is like below;</p>
<pre lang="cs">
[AutoMapFrom(typeof(PersonListDto))]
public class PersonListModel : PersonListDto, INotifyPropertyChanged
{
	public string FullName =&gt; Name + &quot; &quot; + Surname;

	public new ObservableRangeCollection&lt;PhoneInPersonListDto&gt; Phones { get; set; }

	public event PropertyChangedEventHandler PropertyChanged;

	[NotifyPropertyChangedInvocator]
	protected virtual void OnPropertyChanged([CallerMemberName] string propertyName = null)
	{
		PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
	}
}
</pre>
	 
	 	<h5>Listing People</h5>
	<h6>Listing People (View)</h6>
<p>There&#39;s a placeholder label in <b>&lt;ContentPage.Content&gt;</b> tag. Remove that 
Label from and add the below ListView definition in <b>
&lt;ContentPage.Content&gt;</b> tags. In the below code; we populate the listview with 
<b>Persons</b> data. So in the view-model we need a public property <b>Persons.&nbsp; 
Persons </b>
property must be IEnumarable and contain <b>
FullName</b> and <b>EmailAddress</b> string properties. All properties that will 
be binded to view must be public.
<a href="https://developer.xamarin.com/api/property/Xamarin.Forms.ListView.HasUnevenRows/">
HasUnevenRows</a> property automatically sizes list view rows for content. The 
main reason we used <b>TextCell</b> in DataTemplate is performance. Xamarin docs 
say <b>
<a href="https://developer.xamarin.com/guides/xamarin-forms/user-interface/listview/performance/#Improving_ListView_Performance">
<span style="font-weight: 400">Use the built-in cells (like TextCell / 
SwitchCell ) instead of ViewCell whenever you can</span></a>.</b></p>
<pre lang="cs">
&lt;ContentPage.Content&gt;   
<span style="background-color: #FFFF00">&lt;ListView HasUnevenRows=&quot;True&quot;
	 SeparatorVisibility=&quot;None&quot;
	 ItemsSource=&quot;{Binding Persons}&quot;
	 SelectedItem=&quot;{Binding SelectedPerson, Mode=TwoWay}&quot;&gt;
	&lt;ListView.ItemTemplate&gt;
		&lt;DataTemplate&gt;
			&lt;TextCell Text=&quot;{Binding FullName}&quot;  Detail=&quot;{Binding EmailAddress}&quot; /&gt;
		&lt;/DataTemplate&gt;
	&lt;/ListView.ItemTemplate&gt;
&lt;/ListView&gt;</span>
&lt;/ContentPage.Content&gt;
</pre>
<p>Persons data needs to be binded in appearing event of page. To achieve this 
we add a behavior to the page. Add the below code into the <b>
&lt;ContentPage.Content&gt;</b> tags in 
<b>PeopleView.xaml</b>. This behaviour will execute <b>PageAppearingCommand</b> 
in view-model. <strong>PageAppearingCommand</strong> will fetch data from server. For the best 
user experience and smooth navigation it&#39;s better to start long lasting 
operations after you show the view. Never wait the main thread. Do not run blocking 
procedures in constructor.</p>
<pre lang="cs">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;ContentPage ...
    <span style="background-color: #FFFF00">xmlns:behaviors=&quot;clr-namespace:Acme.PhoneBookDemo.Behaviors;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;</span>
 ...&gt;

    &lt;ContentPage.Content&gt;
       &lt;ListView HasUnevenRows=&quot;True&quot;
	 SeparatorVisibility=&quot;None&quot;
	 ItemsSource=&quot;{Binding Persons}&quot;
	 SelectedItem=&quot;{Binding SelectedPerson, Mode=TwoWay}&quot;&gt;
	&lt;ListView.ItemTemplate&gt;
		&lt;DataTemplate&gt;
			&lt;TextCell Text=&quot;{Binding FullName}&quot;  Detail=&quot;{Binding EmailAddress}&quot; /&gt;
		&lt;/DataTemplate&gt;
	&lt;/ListView.ItemTemplate&gt;
       &lt;/ListView&gt;      
    &lt;/ContentPage.Content&gt;

<span style="background-color: #FFFF00">    &lt;ContentPage.Behaviors&gt;
        &lt;behaviors:EventHandlerBehavior EventName=&quot;Appearing&quot;&gt;
            &lt;behaviors:InvokeCommandAction Command=&quot;{Binding PageAppearingCommand}&quot; /&gt;
        &lt;/behaviors:EventHandlerBehavior&gt;
    &lt;/ContentPage.Behaviors&gt;</span>

&lt;/ContentPage&gt;</pre>
 
<p>The final look of <b>PeopleView.xaml</b> is like below;</p>
<pre lang="cs">
&lt;ContentPage xmlns=&quot;http://xamarin.com/schemas/2014/forms&quot;
             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;
             x:Name=&quot;PeoplePage&quot;
             xmlns:base=&quot;clr-namespace:Acme.PhoneBookDemo.ViewModels.Base;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;
             xmlns:behaviors=&quot;clr-namespace:Acme.PhoneBookDeehaviors;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;
             xmlns:extensions=&quot;clr-namespace:Acme.PhoneBookDemo.Extensions.MarkupExtensions;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;
             x:Class=&quot;Acme.PhoneBookDemo.Views.PeopleView&quot;
             Title=&quot;{extensions:Translate PhoneBook}&quot;
             base:ViewManager.AutoWireViewModel=&quot;true&quot;&gt;

    &lt;ContentPage.Content&gt;
        &lt;StackLayout&gt;
            &lt;ListView HasUnevenRows=&quot;True&quot;
                      SeparatorVisibility=&quot;None&quot;
                      ItemsSource=&quot;{Binding Persons}&quot;
                      SelectedItem=&quot;{Binding SelectedPerson, Mode=TwoWay}&quot;&gt;
                &lt;ListView.ItemTemplate&gt;
                    &lt;DataTemplate&gt;
                        &lt;TextCell Text=&quot;{Binding FullName}&quot;  Detail=&quot;{Binding EmailAddress}&quot; /&gt;
                    &lt;/DataTemplate&gt;
                &lt;/ListView.ItemTemplate&gt;
            &lt;/ListView&gt;
        &lt;/StackLayout&gt;
    &lt;/ContentPage.Content&gt;

    &lt;ContentPage.Behaviors&gt;
        &lt;behaviors:EventHandlerBehavior EventName=&quot;Appearing&quot;&gt;
            &lt;behaviors:InvokeCommandAction Command=&quot;{Binding PageAppearingCommand}&quot; /&gt;
        &lt;/behaviors:EventHandlerBehavior&gt;
    &lt;/ContentPage.Behaviors&gt;

&lt;/ContentPage&gt;
</pre>
<h6>Listing People (ViewModel)</h6>
<p>Open <b>PeopleViewModel</b> class. Inject<b>
IPersonAppService</b>. We'll use it for server communication. Create a new async method called <b>FetchDataAsync</b> 
with 
<i>FilterText</i> parameter. Later we&#39;ll use <i>FilterText</i> for searching 
people. Try to add postfix 
<i>Async</i> to async method names. To show an indicator while we are retrieving 
data from server, there&#39;s a method in view-model&#39;s base class called
<b>SetBusyAsync</b>. You can wrap your method with <b>SetBusyAsync</b> to show 
an indicator that a background job is going on.You can create an async commands 
by using <b>HttpRequestCommand.Create()</b>. This is a shortcut extension to 
create an async command. The final look of <b>PeopleViewModel.cs</b> is like 
below;</p>
<pre class="cs">public class PeopleViewModel : XamarinViewModel
{
    public ICommand PageAppearingCommand =&gt; HttpRequestCommand.Create(PageAppearingAsync);
    private readonly IPersonAppService _personAppService;
    private ObservableRangeCollection&lt;PersonListModel&gt; _persons = new ObservableRangeCollection&lt;PersonListModel&gt;();
    
    public PeopleViewModel(IPersonAppService personAppService)
    {
        _personAppService = personAppService;
    }

    public ObservableRangeCollection&lt;PersonListModel&gt; Persons
    {
        get =&gt; _persons;
        set
        {
            _persons = value;
            RaisePropertyChanged(() =&gt; Persons);
        }
    }

    public async Task PageAppearingAsync()
    {
        await FetchDataAsync(FilterText);
    }

    public async Task FetchDataAsync(string filterText = null)
    {
        await SetBusyAsync(async () =&gt;
        {
            var result = await _personAppService.GetPeople(new GetPeopleInput
            {
                Filter = filterText
            });
            
	   var personListModels = ObjectMapper.Map&lt;IEnumerable&lt;PersonListModel&gt;&gt;(result.Items);
            Persons.ReplaceRange(personListModels);
        });
    }
} 
</pre>
<p>Before running the application you can insert one or two records in <strong>
PbPersons</strong> table in database. Run the app, you'll see the below screen;</p>
<img class="img-thumbnail" alt="People Page With Populated Data" src="images/xamarin-phonebook-people-view-populated-data.png"/>
<h5>Filtering People</h5>
<p>To search and filter people we&#39;ll use
<a href="https://developer.xamarin.com/api/type/Xamarin.Forms.SearchBar/">
SearchBar</a> which is Xamarin built-in control that provides a search textbox. 
Open <b>PeopleView.xaml </b>
and&nbsp;add the <b>SearchBar</b> as shown below. We&#39;ll bind <b>
FilterText</b> property to the <strong>SearchBar</strong>. If <b>FilterText</b> changes it&#39;ll 
start to filter from server.</p>
<pre lang="cs">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;ContentPage  ...&gt;
 ...
    &lt;ContentPage.Content&gt;
        &lt;StackLayout&gt;
            <span style="background-color: #FFFF00">&lt;SearchBar Text=&quot;{Binding FilterText}&quot; Placeholder=&quot;{extensions:Translate SearchWithThreeDot}&quot;/&gt;</span>
            &lt;ListView HasUnevenRows=&quot;True&quot; 
                      ItemsSource=&quot;{Binding Persons}&quot;
                      SelectedItem=&quot;{Binding SelectedPerson, Mode=TwoWay}&quot;&gt;
                &lt;ListView.ItemTemplate&gt;
                    &lt;DataTemplate&gt;
                        &lt;TextCell Text=&quot;{Binding FullName}&quot;  Detail=&quot;{Binding EmailAddress}&quot; /&gt;
                    &lt;/DataTemplate&gt;
                &lt;/ListView.ItemTemplate&gt;
            &lt;/ListView&gt;
        &lt;/StackLayout&gt;
    &lt;/ContentPage.Content&gt;
...
&lt;/ContentPage&gt;
</pre>

<p>Now open <b>PeopleViewModel.cs </b>and add the below code... In setter of 
<b>FilterText</b> property, we execute <b>SearchWithDelayAsync()</b> method. As 
we cannot run async method in property setter, we use <b>AsyncRunner</b> to make 
it sync. In 
<b>SearchWithDelayAsync</b> method, <strong>Task.Delay</strong> is used for waiting user for new 
key press. If user changes the filter text within the specified duration then 
fetching will stop for new key press. We&#39;ve specified the delay in <b>
PageDefaults.SearchDelayMilliseconds</b> as 1 second. If no new keypress in 1 
second, it&#39;ll start to search.</p>
<pre lang="cs">
private string _filterText;
 
public string FilterText
{
	get =&gt; _filterText;
	set
	{
		_filterText = value;
		AsyncRunner.Run(SearchWithDelayAsync(_filterText));
	}
}

private async Task SearchWithDelayAsync(string filterText)
{
	if (!string.IsNullOrEmpty(filterText))
	{
		await Task.Delay(PageDefaults.SearchDelayMilliseconds);
		if (filterText != _filterText)
		{
			return;
		}
	}

	await FetchDataAsync(filterText);
}
</pre>
<p>Final look of the filtered list view is like below;</p>
<img class="img-thumbnail" alt="Search People" src="images/xamarin-phonebook-search-people.png"/>

 
 
<p>&nbsp;</p>
<h3>Creating Person Details Page</h3>
<p>Person details page will show personal information and phone numbers of 
selected person. We will be editing personal information, adding and removing 
phone numbers of the person. Also we&#39;ll use the same page for creating new 
person and deleting existing person.To be able to navigate to this page, user taps on a person in the PeopleView. 
Firstly we'll create view, then view-model of the page. Let&#39;s start with creating 
the 
<b>PersonDetailsView.xaml</b>.</p>
<h4>Creating PersonDetailsView</h4>
<p>Basically we&#39;ll do the same steps as we did for <b>PeopleView</b> page. </p>
<ul>
	<li>Copy/paste <b>_SampleView.xaml</b> and rename the file as <b>
	PersonDetailsView.xaml</b>. </li>
	<li>Open <b>PersonDetailsView.xaml</b> and replace all <b>_SampleView </b>to<b> 
	PersonDetailsView</b>.</li>
	<li>Delete the <b>&lt;Label&gt;</b> in <b>PeopleDetails.xaml.</b></li>
	<li>Go to code behind (<i><b><span style="font-weight: 400">PersonDetailsView.xaml.cs</span></b></i>) 
	and rename all <b>
	_SampleView</b> to <b>PersonDetailsView.</b></li>
</ul>
<p>Now we have an empty view. Let's create the view-model of this view.</p>
<h4>Creating PersonDetailsViewModel</h4>
<p>This time we'll not copy/paste sample view model. Add a new class in <strong>
ViewModels </strong>folder with name <strong>
PersonDetailsViewModel</strong>. Inherit this new class from <strong>
XamarinViewModel</strong>. Now we have an empty view-model.</p>


<h5>Showing Personal Information (View)</h5>
<p>The view will have 2 main sections. Personal information on the top and&nbsp; 
phone numbers on the bottom. Let&#39;s create personal information section!</p>

	Add highlighted rows to <b>ContentPage </b>tag.
<ul>
	<li><b>xmlns:extensions</b>: To use <i>Translate</i> extension.</li>
	<li><b>xmlns:controls</b>: To use <i>CardView</i> control.</li>
	<li><b>x:Name</b>: To use as reference.</li>
	<li><b>Title</b>: To show a page title. It&#39;ll dynamically change. For new 
	person creation we&#39;ll write &quot;Create New Person&quot;, for existing person edit 
	we&#39;ll write the name of person here.</li>
</ul>
<pre lang="cs">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;ContentPage xmlns=&quot;http://xamarin.com/schemas/2014/forms&quot;
             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;
             xmlns:base=&quot;clr-namespace:Acme.PhoneBookDemo.ViewModels.Base;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;
             x:Class=&quot;Acme.PhoneBookDemo.Views.PersonDetailsView&quot;
             base:ViewManager.AutoWireViewModel=&quot;true&quot;
             <span style="background-color: #FFFF00">xmlns:extensions=&quot;clr-namespace:Acme.PhoneBookDemo.Extensions.MarkupExtensions;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;</span>
             <span style="background-color: #FFFF00">xmlns:controls=&quot;clr-namespace:Acme.PhoneBookDemo.Controls;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;</span>
             <span style="background-color: #FFFF00">x:Name=&quot;PersonDetailsPage&quot;</span>
             <span style="background-color: #FFFF00">Title=&quot;{Binding Title}&quot;</span>&gt;
    &lt;ContentPage.Content&gt;
       ...
    &lt;/ContentPage.Content&gt;
&lt;/ContentPage&gt;</pre>
	Then add the <b>ListView</b> as root item in <b>&lt;ContentPage.Content&gt;</b> 
	as shown below.&nbsp;
	  <pre lang="cs">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;ContentPage xmlns=&quot;http://xamarin.com/schemas/2014/forms&quot;
             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;
             xmlns:base=&quot;clr-namespace:Acme.PhoneBookDemo.ViewModels.Base;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;
             x:Class=&quot;Acme.PhoneBookDemo.Views.PersonDetailsView&quot;
             base:ViewManager.AutoWireViewModel=&quot;true&quot;
             xmlns:extensions=&quot;clr-namespace:Acme.PhoneBookDemo.Extensions.MarkupExtensions;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;
             xmlns:controls=&quot;clr-namespace:Acme.PhoneBookDemo.Controls;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;
             x:Name=&quot;PersonDetailsPage&quot;
             Title=&quot;{Binding Title}&quot;&gt;
    &lt;ContentPage.Content&gt;
<span style="background-color: #FFFF00">        &lt;ListView HasUnevenRows=&quot;True&quot;&gt;
            &lt;ListView.Header&gt;
              
                    &lt;controls:CardView Margin=&quot;0,10&quot; &gt;
                        &lt;StackLayout Padding=&quot;10&quot; Spacing=&quot;0&quot; &gt;
                            &lt;controls:LabelSection Text=&quot;{extensions:Translate PersonalInformations}&quot;/&gt;
                            &lt;controls:Divider Margin=&quot;0,0,0,5&quot;/&gt;

                            &lt;Label Text=&quot;{extensions:Translate Name}&quot;&gt;&lt;/Label&gt;
                            &lt;Entry Text=&quot;{Binding Model.Name, Mode=TwoWay}&quot;/&gt;

                            &lt;Label Text=&quot;{extensions:Translate Surname}&quot;&gt;&lt;/Label&gt;
                            &lt;Entry Text=&quot;{Binding Model.Surname, Mode=TwoWay}&quot;/&gt;

                            &lt;Label Text=&quot;{extensions:Translate EmailAddress}&quot;&gt;&lt;/Label&gt;
                            &lt;Entry Text=&quot;{Binding Model.EmailAddress, Mode=TwoWay}&quot; Margin=&quot;0,0,0,10&quot;/&gt;

                        &lt;/StackLayout&gt;
                    &lt;/controls:CardView&gt;

            &lt;/ListView.Header&gt;
        &lt;/ListView&gt;</span>
    &lt;/ContentPage.Content&gt;
&lt;/ContentPage&gt;</pre>
	ListView works best when it&#39;s root element (otherwise you may have scrolling 
	issues). That&#39;s why we put ListView in the first place. ListView consists of 
	3 parts; Header, Items, Footer...&nbsp; We&#39;ll use header to show personal 
	information and items to list phone numbers. Footer will not be used.<p>We 
	set ListView <b>
	<a href="https://developer.xamarin.com/api/property/Xamarin.Forms.ListView.HasUnevenRows/">HasUnevenRows=&quot;True&quot;</a>.</b> This is for automatically sizing list view 
	rows. </p>
	<p>In the <b>ListView.Header </b>tag we place a <b>CardView</b>. This is a 
	custom control that draws a border to
	<span id="result_box0" class="short_text" lang="en"><span class>highlight 
	section.<span lang="tr"> </span></span></span><b>LabelSection</b> is another custom control that 
	shows label as a title.<b> Divider</b> is a custom conrol as well that 
	draws a horizontal line.</p>
	<p>In <b>CardView,</b> add a <b>&lt;StackLayout&gt;</b> to show elements 
	vertically. Put labels, entries for <b>Name</b>, <b>Surname</b> and <b>EmailAddress</b> fields. All the entries are
	<a href="https://developer.xamarin.com/api/field/Xamarin.Forms.BindingMode.TwoWay/">TwoWay</a> binding. Because we propagate value in both directions.</p>
	<p>We&#39;ve completed the view let&#39;s create 
<b>PersonDetailsViewModel</b> class.</p>
	
<div class="bs-callout bs-callout-info">
	<p><i class="fa fa-info-circle"></i> ListView control seems to be an easy but 
	complicated control. We recommend to use ListView in this circumtances;</p>
	<ul>
		<li>Try to use ListView as root item of the Page. </li>
		<li>Do not use nested ListViews (ListView in ListView) </li>
		<li>Use
			<a href="https://developer.xamarin.com/api/type/Xamarin.Forms.TextCell/">
		TextCell</a> and
			<a href="https://developer.xamarin.com/api/type/Xamarin.Forms.SwitchCell/">
		SwitchCell</a> wherever you can</li>
		<li>Avoid placing a ListView inside a
			<a href="https://developer.xamarin.com/guides/xamarin-forms/user-interface/layouts/scroll-view/">
		ScrollView</a></li>
	</ul></div>

<h5>Showing Personal Information (PersonDetailsViewModel)</h5>
<ul>
	<li>Add a public property <b>PersonListModel</b> with name <b>Model</b>. 
	We&#39;ll execute <b>RaisePropertyChange()</b> in setter of property to notify 
	the view that value is changed.</li>
	<li>Add another public bool property with name <b>IsExistingPerson</b> to 
	store the new or edit state. 
	</li>
	<li>To get the selected person from <b>PeopleViewModel</b> we&#39;ll use the <b>
	InitializeAsync(object navigationData)</b>&nbsp; method. This method is 
	located in the base class of view model and is being executed by navigation 
	service. You need to cast navigationData to your specified type. We&#39;ll&nbsp; 
	use the same view model for new person creation. So if <b>navigationData</b> 
	is null it means it&#39;s a new person. The boolean property <b>IsExistingPerson </b> 
	is being set here for new person or existing person discrimination. <p>
	Finally <b>
	PersonDetailsViewModel.cs</b> will be like below;</p>
	<pre lang="cs">public class PersonDetailsViewModel : XamarinViewModel
{
	private PersonListModel _model;
	private bool _isExistingPerson;

	public string Title =&gt; IsExistingPerson ? Model.FullName : L.Localize(&quot;CreateNewPerson&quot;);

	public PersonListModel Model
	{
		get =&gt; _model;
		set
		{
			_model = value;
			RaisePropertyChanged(() =&gt; Model);
		}
	}

	public bool IsExistingPerson
	{
		get =&gt; _isExistingPerson;
		set
		{
			_isExistingPerson = value;
			RaisePropertyChanged(() =&gt; IsExistingPerson);
		}
	}

	public override async Task InitializeAsync(object navigationData)
	{
		IsExistingPerson = navigationData != null;

		if (IsExistingPerson)
		{
			Model = (PersonListModel)navigationData;
		}
		else
		{
			Model = new PersonListModel();
		}
	}
}</pre>

	Run the application and navigate to a person. You&#39;ll see the page below;<br>
<img class="img-thumbnail" alt="Search People" src="images/xamarin-phonebook-personal-information-show.png"/>

	</li>
	 
</ul>
<p>&nbsp;</p>
<h4>Editing Existing Person</h4>
<p>Saving function covers creation of new person and updating the existing person. To 
save person, we&#39;ll add a save button to the view and a command to view-model.
Open <b>PersonDetailsView.xaml </b>and add the highlighted rows below;</p>
<pre lang="cs">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;ContentPage xmlns=&quot;http://xamarin.com/schemas/2014/forms&quot;
             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;
             xmlns:base=&quot;clr-namespace:Acme.PhoneBookDemo.ViewModels.Base;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;
             x:Class=&quot;Acme.PhoneBookDemo.Views.PersonDetailsView&quot;
             base:ViewManager.AutoWireViewModel=&quot;true&quot;
             xmlns:extensions=&quot;clr-namespace:Acme.PhoneBookDemo.Extensions.MarkupExtensions;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;
             xmlns:controls=&quot;clr-namespace:Acme.PhoneBookDemo.Controls;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;
             x:Name=&quot;PersonDetailsPage&quot;
             Title=&quot;{Binding Title}&quot;&gt;
    &lt;ContentPage.Content&gt;
        &lt;ListView HasUnevenRows=&quot;True&quot;&gt;
            &lt;ListView.Header&gt;
                &lt;StackLayout&gt;
                   
                    &lt;controls:CardView Margin=&quot;0,10&quot; &gt;
                        &lt;StackLayout Padding=&quot;10&quot; Spacing=&quot;0&quot; &gt;
                            &lt;controls:LabelSection Text=&quot;{extensions:Translate PersonalInformations}&quot;/&gt;
                            &lt;controls:Divider Margin=&quot;0,0,0,5&quot;/&gt;

                            &lt;Label Text=&quot;{extensions:Translate Name}&quot;&gt;&lt;/Label&gt;
                            &lt;Entry Text=&quot;{Binding Model.Name, Mode=TwoWay}&quot;/&gt;

                            &lt;Label Text=&quot;{extensions:Translate Surname}&quot;&gt;&lt;/Label&gt;
                            &lt;Entry Text=&quot;{Binding Model.Surname, Mode=TwoWay}&quot;/&gt;

                            &lt;Label Text=&quot;{extensions:Translate EmailAddress}&quot;&gt;&lt;/Label&gt;
                            &lt;Entry Text=&quot;{Binding Model.EmailAddress, Mode=TwoWay}&quot; Margin=&quot;0,0,0,10&quot;/&gt;

<span style="background-color: #FFFF00">                            &lt;!-- SAVE BUTTON  --&gt;
                            &lt;Button Margin=&quot;{StaticResource ActionButtonMargin}&quot; 
                                        Style=&quot;{StaticResource ActionButton}&quot; 
                                        Text=&quot;{extensions:Translate Save}&quot;
                                        Command=&quot;{Binding SavePersonCommand}&quot;/&gt;</span>
                     
                        &lt;/StackLayout&gt;
                    &lt;/controls:CardView&gt;
                &lt;/StackLayout&gt;
            &lt;/ListView.Header&gt;
        &lt;/ListView&gt;
    &lt;/ContentPage.Content&gt;
&lt;/ContentPage&gt;
</pre>

<p>We put a save button and bind the command property to <strong>SavePersonCommand</strong>. 
Also there's a built-in style called <strong>ActionButton</strong> in <strong>
App.xaml</strong>. This style, changes the look of button more stylish rather than 
native looking.</p>

<p>Now open <b>PersonDetailsViewModel</b> class and add the below codes;</p>
<pre lang="cs">public ICommand SavePersonCommand =&gt; AsyncCommand.Create(SavePersonAsync);

public PersonDetailsViewModel(IPersonAppService personAppService)
{
	_personAppService = personAppService;
}

private async Task SavePersonAsync()
{
	if (IsExistingPerson)
	{
		await UpdateExistingPersonAsync();
	}
	else
	{
		await CreateNewPersonAsync();
	}

	await NavigationService.GoBackAsync();
}

private async Task UpdateExistingPersonAsync()
{
	var editPersonInput = new EditPersonInput
	{
		EmailAddress = Model.EmailAddress,
		Name = Model.Name,
		Surname = Model.Surname,
		Id = Model.Id
	};

	await _personAppService.EditPerson(editPersonInput);
}

private async Task CreateNewPersonAsync()
{
	var createPersonInput = new CreatePersonInput
	{
		EmailAddress = Model.EmailAddress,
		Name = Model.Name,
		Surname = Model.Surname,
	};

	await _personAppService.CreatePerson(createPersonInput);
}


</pre>
<p>We inject <b>IPersonAppService</b> to send person data to server. In <b>SavePersonAsync()</b> method we split the procedure into two 
parts: <b>UpdateExistingPersonAsync()</b> and <b>CreateNewPersonAsync(). </b>
According to the boolean <b>IsExistingPerson</b> we'll update or create the 
user.</p>
<p>Up to here, we listed people, navigated to the selected person, showed 
personal details and update them. Now let&#39;s 
implement new person creation functionality. </p>
<h4>Creating New Person</h4>
<p>We&#39;ve already implemented create new person in <b>PersonDetailsViewModel</b>. 
We&#39;ll just need to navigate to PersonDetailsView with an empty <strong>navigationData</strong>. 
The rest will work fine.</p>
<ul>
	<li>Creating new person needs permission. Open <b>PermissionKey</b> class 
	and add the below line. We&#39;ll use it to hide/show Create Person button. <pre lang="cs">
public const string PhoneBookCreatePerson = &quot;Pages.Tenant.PhoneBook.CreatePerson&quot;;
</pre></li><li>Open <b>PeopleView.xaml</b> and add the lines to the <b>
	&lt;ContentPage&gt;</b> 
	tag. The <b>x:Name</b> gives a name to the page. It&#39;s needed for 
	referencing. And we import <b>permission</b> namespace to use PermissionKey 
	class.<pre lang="pre">
&lt;ContentPage xmlns=&quot;http://xamarin.com/schemas/2014/forms&quot;
             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;
             <span style="background-color: #FFFF00">x:Name=&quot;PeoplePage&quot;</span>
             xmlns:base=&quot;clr-namespace:Acme.PhoneBookDemo.ViewModels.Base;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;
             xmlns:behaviors=&quot;clr-namespace:Acme.PhoneBookDemo.Behaviors;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;
             xmlns:extensions=&quot;clr-namespace:Acme.PhoneBookDemo.Extensions.MarkupExtensions;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;
             xmlns:controls=&quot;clr-namespace:Acme.PhoneBookDemo.Controls;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;
             <span style="background-color: #FFFF00">xmlns:permission=&quot;clr-namespace:Acme.PhoneBookDemo.Services.Permission;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;</span>
             x:Class=&quot;Acme.PhoneBookDemo.Views.PeopleView&quot;
             Title=&quot;{extensions:Translate PhoneBook}&quot;
             base:ViewManager.AutoWireViewModel=&quot;true&quot;&gt;</pre>
<li>Adding a toolbar item is easy! Insert toolbar item into <b>
&lt;ContentPage.ToolbarItems&gt; </b>tag. We used a special toolbar item which is 
inherited from ToolbarItem. This extended toolbar item can be visible/hidden by 
binding a property. The default ToolbarItem has no such feature. In the IsVisible 
property we used <b>HasPermission</b> extension. This extension is located in<i> 
Extensions\MarkupExtensions</i>. It&#39;s returns true/false according to the <b>Text</b> 
property. And as <b>Text</b> property we pass <b>PermissionKey.PhoneBookCreatePerson.</b> 
The command property is being executed when button is tapped. We binded <b>
CreateNewPersonCommand</b>. In the next step this command will be added to the 
view model.<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;ContentPage xmlns=&quot;http://xamarin.com/schemas/2014/forms&quot;
             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;
             x:Name=&quot;PeoplePage&quot;
             xmlns:base=&quot;clr-namespace:Acme.PhoneBookDemo.ViewModels.Base;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;
             xmlns:behaviors=&quot;clr-namespace:Acme.PhoneBookDemo.Behaviors;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;
             xmlns:extensions=&quot;clr-namespace:Acme.PhoneBookDemo.Extensions.MarkupExtensions;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;
             xmlns:controls=&quot;clr-namespace:Acme.PhoneBookDemo.Controls;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;
             xmlns:permission=&quot;clr-namespace:Acme.PhoneBookDemo.Services.Permission;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;
             x:Class=&quot;Acme.PhoneBookDemo.Views.PeopleView&quot;
             Title=&quot;{extensions:Translate PhoneBook}&quot;
             base:ViewManager.AutoWireViewModel=&quot;true&quot;&gt;

<span style="background-color: #FFFF00">    &lt;ContentPage.ToolbarItems&gt;
        &lt;controls:HideableToolbarItem 
            Text=&quot;{extensions:Translate CreateNewPerson}&quot;  
            Command=&quot;{Binding CreateNewPersonCommand}&quot; 
            IsVisible=&quot;{extensions:HasPermission Text={x:Static permission:PermissionKey.PhoneBookCreatePerson}}&quot;
            ParentPage=&quot;{x:Reference PeoplePage}&quot; /&gt;
    &lt;/ContentPage.ToolbarItems&gt;</span>

    &lt;ContentPage.Content&gt;
        &lt;StackLayout&gt;
            &lt;SearchBar Text=&quot;{Binding FilterText}&quot; Placeholder=&quot;{extensions:Translate SearchWithThreeDot}&quot;/&gt;
            &lt;ListView HasUnevenRows=&quot;True&quot; 
                      ItemsSource=&quot;{Binding Persons}&quot;
                      SelectedItem=&quot;{Binding SelectedPerson, Mode=TwoWay}&quot;&gt;
                &lt;ListView.ItemTemplate&gt;
                    &lt;DataTemplate&gt;
                        &lt;TextCell Text=&quot;{Binding FullName}&quot;  Detail=&quot;{Binding EmailAddress}&quot; /&gt;
                    &lt;/DataTemplate&gt;
                &lt;/ListView.ItemTemplate&gt;
            &lt;/ListView&gt;
        &lt;/StackLayout&gt;
    &lt;/ContentPage.Content&gt;

    &lt;ContentPage.Behaviors&gt;
        &lt;behaviors:EventHandlerBehavior EventName=&quot;Appearing&quot;&gt;
            &lt;behaviors:InvokeCommandAction Command=&quot;{Binding PageAppearingCommand}&quot; /&gt;
        &lt;/behaviors:EventHandlerBehavior&gt;
    &lt;/ContentPage.Behaviors&gt;

&lt;/ContentPage&gt;</pre></li>
	<li>Now open <b>PeopleViewModel.cs</b> and add the below code... We navigate to 
	<b>PersonDetailsView</b> with <b>null</b> parameter because we handle the <b>null</b> case as new 
	person creation.<pre lang="cs">
public ICommand CreateNewPersonCommand =&gt; HttpRequestCommand.Create(CreateNewPersonAsync);,
public async Task CreateNewPersonAsync()
{
    await GotoPersonDetailsAsync(null);
}

private async Task GotoPersonDetailsAsync(PersonListModel person)
{
    await NavigationService.SetDetailPageAsync(typeof(PersonDetailsView), person, pushToStack: true);
}

</pre></li>
</ul>

<h4>Validating Input</h4>
We&#39;ve implemented create and update person functions but we didn&#39;t validate 
the input. Validating an object before sending to server is easy. Open 
<b>PersonDetailsViewModel.cs&nbsp; </b>and add the <b>Validate()</b> method 
below;<br>
<pre lang="cs">
private static bool Validate(object input)
{
    var validationResult = DataAnnotationsValidator.Validate(input);
    if (validationResult.IsValid)
    {
        return true;
    }

    UserDialogHelper.Warn(validationResult.ConsolidatedMessage);
    return false;
}

</pre>

<p>In the <b>Validate()</b> method we validate the input before sending to server. 
It checks input fields against data annotations. If it fails, an alert message 
is shown to user. Then use <strong>Validate()</strong> method in <b>UpdateExistingPersonAsync()</b> 
and in <b>CreateNewPersonAsync()</b><strong> </strong>&nbsp;methods like below </p>
<pre lang="cs">
private async Task UpdateExistingPersonAsync()
{
	var editPersonInput = new EditPersonInput
	{
		EmailAddress = Model.EmailAddress,
		Name = Model.Name,
		Surname = Model.Surname,
		Id = Model.Id
	};

<span style="background-color: #FFFF00">	if (!Validate(editPersonInput))
	{
		return;
	}</span>

	await _personAppService.EditPerson(editPersonInput);
}

private async Task CreateNewPersonAsync()
{
	var createPersonInput = new CreatePersonInput
	{
		EmailAddress = Model.EmailAddress,
		Name = Model.Name,
		Surname = Model.Surname,
	};

<span style="background-color: #FFFF00">	if (!Validate(createPersonInput))
	{
		return;
	}</span>

	await _personAppService.CreatePerson(createPersonInput);
}
</pre>

<p>To test validation you can try to <b>create a person</b> with an<b> invalid 
email address</b>. <br>
To test what we&#39;ve done so far, you can run the app and see if it&#39;s working as 
expected.</p>
<h4>Deleting Person</h4>
<ul>
	<li>Add the delete permission key in <strong>PermissionKey.cs</strong>. <pre lang="cs">
public const string PhoneBookDeletePerson = &quot;Pages.Tenant.PhoneBook.DeletePerson&quot;; </pre></li>
<li>
<p>We&#39;ll place a delete button inside the person details view. So open the <b>
PersonDetailsView.xaml</b> and add the highighted code as delete button. The command of button is <b>DeletePersonCommand,</b> we&#39;ll add the command to 
view-model in the next step. And visibility of button is being binded to 
<b>IsDeleteButtonVisible</b> property. The reason is we&#39;ll hide the button if 
user has no delete permission or it&#39;s a new user creation page.</p>
<pre lang="cs">
&lt;ContentPage.Content&gt;
	&lt;ListView HasUnevenRows=&quot;True&quot;   
			  ItemsSource=&quot;{Binding Model.Phones}&quot; Margin=&quot;10&quot;&gt;

		&lt;ListView.Header&gt;
			&lt;StackLayout&gt;
			   
				&lt;controls:CardView Margin=&quot;0,10&quot; &gt;
					&lt;StackLayout Padding=&quot;10&quot; Spacing=&quot;0&quot; &gt;
						&lt;controls:LabelSection Text=&quot;{extensions:Translate PersonalInformations}&quot;/&gt;
						&lt;controls:Divider Margin=&quot;0,0,0,5&quot;/&gt;

						&lt;Label Text=&quot;{extensions:Translate Name}&quot;&gt;&lt;/Label&gt;
						&lt;Entry Text=&quot;{Binding Model.Name, Mode=TwoWay}&quot;/&gt;

						&lt;Label Text=&quot;{extensions:Translate Surname}&quot;&gt;&lt;/Label&gt;
						&lt;Entry Text=&quot;{Binding Model.Surname, Mode=TwoWay}&quot;/&gt;

						&lt;Label Text=&quot;{extensions:Translate EmailAddress}&quot;&gt;&lt;/Label&gt;
						&lt;Entry Text=&quot;{Binding Model.EmailAddress, Mode=TwoWay}&quot; Margin=&quot;0,0,0,10&quot;/&gt;

						&lt;!-- SAVE BUTTON  --&gt;
						&lt;Button Margin=&quot;{StaticResource ActionButtonMargin}&quot; 
									Style=&quot;{StaticResource ActionButton}&quot; 
									Text=&quot;{extensions:Translate Save}&quot;
									Command=&quot;{Binding SavePersonCommand}&quot;/&gt;

<span style="background-color: #FFFF00">						&lt;!--  DELETE BUTTON  --&gt;
						&lt;Button Margin=&quot;{StaticResource ActionButtonMargin}&quot; 
									IsVisible=&quot;{Binding IsDeleteButtonVisible}&quot;
									Style=&quot;{StaticResource DangerButton}&quot; 
									Text=&quot;{extensions:Translate Delete}&quot;  
									Command=&quot;{Binding DeletePersonCommand}&quot;/&gt;</span>
					&lt;/StackLayout&gt;
				&lt;/controls:CardView&gt;
		...
</pre>

</li>

<li>
<p>Open <b>PersonDetailsViewModel.cs</b> and add the below highlighted codes; </p>
	
	<pre lang="tr">using System.Threading.Tasks;
using System.Windows.Input;
<span style="background-color: #FFFF00">using Abp.Application.Services.Dto;</span>
using Acme.PhoneBookDemo.Core.Threading;
using Acme.PhoneBookDemo.PhoneBook;
using Acme.PhoneBookDemo.PhoneBook.Dto;
<span style="background-color: #FFFF00">using Acme.PhoneBookDemo.Services.Permission;</span>
using Acme.PhoneBookDemo.UI;
using Acme.PhoneBookDemo.Validations;
using Acme.PhoneBookDemo.ViewModels.Base;

namespace Acme.PhoneBookDemo.ViewModels
{
    public class PersonDetailsViewModel : XamarinViewModel
    {
        private readonly IPersonAppService _personAppService;
       <span style="background-color: #FFFF00"> private readonly IPermissionService _permissionService;</span>
        private bool _isNewPerson;
        <span style="background-color: #FFFF00">private bool _isDeleteButtonVisible;
</span>
<span style="background-color: #FFFF00">        public bool IsDeleteButtonVisible
        {
                get =&gt; _isDeleteButtonVisible;
                set
                {
                        _isDeleteButtonVisible = value;
                        RaisePropertyChanged(() =&gt; IsDeleteButtonVisible);
                }
        }</span>

        public ICommand SavePersonCommand =&gt; AsyncCommand.Create(SavePersonAsync);
        <span style="background-color: #FFFF00">public ICommand DeletePersonCommand =&gt; AsyncCommand.Create(DeletePersonAsync);</span>

	<span style="background-color: #FFFF00">private async Task DeletePersonAsync()
</span>	<span style="background-color: #FFFF00">{
</span>	<span style="background-color: #FFFF00">	var accepted = await UserDialogs.Instance.ConfirmAsync(L.Localize(&quot;UserDeleteWarningMessage&quot;, Model.FullName),
</span>	<span style="background-color: #FFFF00">		L.Localize(&quot;AreYouSure&quot;), L.Localize(&quot;YesDelete&quot;), L.Localize(&quot;Cancel&quot;));
</span>	<span style="background-color: #FFFF00">
</span>	<span style="background-color: #FFFF00">	if (!accepted)
</span>	<span style="background-color: #FFFF00">	{
</span>	<span style="background-color: #FFFF00">		return;
</span>	<span style="background-color: #FFFF00">	}
</span>	<span style="background-color: #FFFF00">
</span>	<span style="background-color: #FFFF00">	await SetBusyAsync(async () =&gt;
</span>	<span style="background-color: #FFFF00">	{
</span>	<span style="background-color: #FFFF00">		await _personAppService.DeletePerson(new EntityDto(Model.Id));
</span>	<span style="background-color: #FFFF00">		await NavigationService.GoBackAsync();
</span>	<span style="background-color: #FFFF00">	});
</span>	<span style="background-color: #FFFF00">}</span>

       ...
        public PersonDetailsViewModel(IPersonAppService personAppService, <span style="background-color: #FFFF00">IPermissionService permissionService</span>)
        {
            _personAppService = personAppService;
            <span style="background-color: #FFFF00">_permissionService = permissionService;</span>
        }

        public override async Task InitializeAsync(object navigationData)
        {
            IsExistingPerson = navigationData != null;
         
            if (IsExistingPerson)
            {
                Model = (PersonListModel)navigationData;
<span style="background-color: #FFFF00">                IsDeleteButtonVisible = _permissionService.HasPermission(PermissionKey.PhoneBookDeletePerson);
            }
            else
            {
                Model = new PersonListModel();
                IsDeleteButtonVisible = false;
            }</span>
<span style="background-color: #FFFF00">        }</span>
    }
}
</pre>


<p>In the above code, we inject <b>IPermissionService</b> to check wheter user 
has delete permission. The delete button will be visible if user has permission. We create the <b>
DeletePersonCommand</b>. In this command we ask user for a confirmation with <b>
UserDialogs.Instance.ConfirmAsync(...).</b> If user accepts we make request to 
server with <b>_personAppService.DeletePerson(...) </b>then we leave the screen 
with <b>NavigationService.GoBackAsync() </b>method.</p>
	</li>
</ul>


<h4>Managing Phone Numbers</h4>
 
<h5>Listing Phone Numbers</h5>
<p>To list phone numbers we&#39;ll use the ListView that we&#39;ve added to <b>
PersonDetailsView.xaml<br>
</b>Open <b>PersonDetailsView.xaml</b> and add the highlighted codes;<br>
</p>
<pre lang="cs">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;ContentPage xmlns=&quot;http://xamarin.com/schemas/2014/forms&quot;
             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;
             xmlns:base=&quot;clr-namespace:Acme.PhoneBookDemo.ViewModels.Base;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;
             x:Class=&quot;Acme.PhoneBookDemo.Views.PersonDetailsView&quot;
             base:ViewManager.AutoWireViewModel=&quot;true&quot;
             xmlns:extensions=&quot;clr-namespace:Acme.PhoneBookDemo.Extensions.MarkupExtensions;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;
             xmlns:controls=&quot;clr-namespace:Acme.PhoneBookDemo.Controls;assembly=Acme.PhoneBookDemo.Mobile.Shared&quot;
             xmlns:iconize=&quot;clr-namespace:FormsPlugin.Iconize;assembly=FormsPlugin.Iconize&quot;
             x:Name=&quot;PersonDetailsPage&quot;
             Title=&quot;{Binding Title}&quot;&gt;
    &lt;ContentPage.Content&gt;
        &lt;ListView HasUnevenRows=&quot;True&quot;   
		Margin=&quot;10&quot;
                  <span style="background-color: #FFFF00">ItemsSource=&quot;{Binding Model.Phones}&quot;</span>&gt;
            &lt;ListView.Header&gt;
                &lt;StackLayout&gt;
                    &lt;controls:CardView Margin=&quot;0,10&quot; &gt;
                        &lt;StackLayout Padding=&quot;10&quot; Spacing=&quot;0&quot; &gt;
                            &lt;controls:LabelSection Text=&quot;{extensions:Translate PersonalInformations}&quot;/&gt;
                            &lt;controls:Divider Margin=&quot;0,0,0,5&quot;/&gt;

                            &lt;Label Text=&quot;{extensions:Translate Name}&quot;&gt;&lt;/Label&gt;
                            &lt;Entry Text=&quot;{Binding Model.Name, Mode=TwoWay}&quot;/&gt;

                            &lt;Label Text=&quot;{extensions:Translate Surname}&quot;&gt;&lt;/Label&gt;
                            &lt;Entry Text=&quot;{Binding Model.Surname, Mode=TwoWay}&quot;/&gt;

                            &lt;Label Text=&quot;{extensions:Translate EmailAddress}&quot;&gt;&lt;/Label&gt;
                            &lt;Entry Text=&quot;{Binding Model.EmailAddress, Mode=TwoWay}&quot; Margin=&quot;0,0,0,10&quot;/&gt;

                            &lt;!-- SAVE BUTTON  --&gt;
                            &lt;Button Margin=&quot;{StaticResource ActionButtonMargin}&quot; 
                                        Style=&quot;{StaticResource ActionButton}&quot; 
                                        Text=&quot;{extensions:Translate Save}&quot;
                                        Command=&quot;{Binding SavePersonCommand}&quot;/&gt;

                            &lt;!--  DELETE BUTTON  --&gt;
                            &lt;Button Margin=&quot;{StaticResource ActionButtonMargin}&quot; 
                                        IsVisible=&quot;{Binding IsDeleteButtonVisible}&quot;
                                        Style=&quot;{StaticResource DangerButton}&quot; 
                                        Text=&quot;{extensions:Translate Delete}&quot;  
                                        Command=&quot;{Binding DeletePersonCommand}&quot;/&gt;
                        &lt;/StackLayout&gt;
                    &lt;/controls:CardView&gt;
                &lt;/StackLayout&gt;
            &lt;/ListView.Header&gt;
            
<span style="background-color: #FFFF00">            &lt;ListView.ItemTemplate&gt;
                &lt;DataTemplate&gt;
                    &lt;ViewCell&gt;
                        &lt;StackLayout Orientation=&quot;Horizontal&quot; BackgroundColor=&quot;White&quot; Padding=&quot;10,0,10,0&quot; &gt;
                            &lt;Label Text=&quot;{Binding Type}&quot; VerticalOptions=&quot;Center&quot; FontAttributes=&quot;Bold&quot;/&gt;
                            &lt;Label Text=&quot;{Binding Number}&quot; Style=&quot;{StaticResource ActiveLabel}&quot; VerticalOptions=&quot;Center&quot;/&gt;
                        &lt;/StackLayout&gt;
                    &lt;/ViewCell&gt;
                &lt;/DataTemplate&gt;
            &lt;/ListView.ItemTemplate&gt;</span>

        &lt;/ListView&gt;
    &lt;/ContentPage.Content&gt;
&lt;/ContentPage&gt;
</pre>

<p>In the above code, we bind <b>Model.Phones</b> to<b> ListView ItemsSource</b>.
<b>Model.Phones </b>is type of <b>
ObservableRangeCollection&lt;PhoneInPersonListDto&gt;</b> and located in <b>
PersonDetailsViewModel</b> class. The view will automatically refresh itself if 
any Item is inserted, removed from <b>Model.Phones. </b>In <b>ListView.ItemTemplate</b>, the phone numbers will be listed. We add <b>
DataTemplate</b> and <b>ViewCell</b> tags. Then add a horizontally orientated <b>
StackLayout</b>. 
We put labels for <b>Type</b> and <b>Number.</b> These properties exist in <b>
PersonListModel </b>class. We don&#39;t need to modify view-model because <b>
Model.Phones</b> property was already populated in <b>PeopleViewModel</b> and 
transferred to <b>PersonDetailsViewModel</b> with <b>InitializeAsync()</b> 
method.</p>
<p>You can run the app to see that phone numbers are being listed.</p>
<img class="img-thumbnail" alt="People with Phone Numbers" src="images/xamarin-phonebook-listing-phone-numbers.png"/>

<p>&nbsp;</p>
<h5>Adding New Phone Number</h5>
<p>To add new phone numbers, add a new <b>CardView</b> to <b>PersonDetailsView.xaml.&nbsp;
<br>
</b> The <b>CardView</b> is a custom control to show a bordered box. We&#39;ll hide 
this <b>CardView</b> if user has no person-create-permission. Additionally it'll 
not be shown for creating a new 
person. We bind <b>IsExistingPerson</b> boolean property to set the 
visibility of the CardView. We add a <b>Picker</b> to list phone types: <em>Mobile, Home and Business</em>. The 
picker <strong>ItemsSource</strong> is a list of string populated from <b>PhoneType</b> enum. 
Picker has another field <strong>SelectedItem</strong>... This will set <b>SelectedPhoneType</b> 
property in view-model. As <strong>SelectedPhoneType</strong> is string, we'll 
convert it to <strong>PhoneType</strong> enum.<br>
We put <b>Entry</b> field for phone number value. To add the phone number, we 
place a button with the command <b>AddPhoneNumberCommand</b>. We need the <b>Id</b> 
of the person to use in <b>AddPhoneNumberCommand</b>. To send the <b>Id </b>&nbsp;with 
command, we use <b>CommandParameter</b> of button. In the Model we have <b>Id</b> 
field. Setting button enable state is done with <b>IsAddPhoneButtonEnabled</b>. 
It&#39;s a boolean property that checks if <b>NewPhoneNumber</b> property is empty 
or not. If it&#39;s empty button will be disabled.</p>

<pre lang="cs">
ContentPage  ......&gt;
    &lt;ContentPage.Content&gt;
        &lt;ListView HasUnevenRows=&quot;True&quot;   
                  ItemsSource=&quot;{Binding Model.Phones}&quot; Margin=&quot;10&quot;&gt;

            &lt;ListView.Header&gt;
                &lt;StackLayout&gt;
                   
                    &lt;controls:CardView Margin=&quot;0,10&quot; &gt;
                        ....
                    &lt;/controls:CardView&gt;

<span style="background-color: #FFFF00">                    &lt;controls:CardView Margin=&quot;0&quot; IsVisible=&quot;{Binding IsExistingPerson}&quot; &gt;
                        &lt;StackLayout Padding=&quot;10&quot; Spacing=&quot;0&quot;&gt;

                            &lt;controls:LabelSection Text=&quot;{extensions:Translate PhoneNumber}&quot;/&gt;
                            &lt;controls:Divider Margin=&quot;0,0,0,5&quot;/&gt;

                            &lt;Grid&gt;
                                &lt;Grid.ColumnDefinitions&gt;
                                    &lt;ColumnDefinition Width=&quot;0.3*&quot;/&gt;
                                    &lt;ColumnDefinition Width=&quot;0.7*&quot;/&gt;
                                &lt;/Grid.ColumnDefinitions&gt;

                                &lt;Picker Title=&quot;{extensions:Translate Type}&quot;
                                        ItemsSource=&quot;{Binding PhoneTypes}&quot; 
                                        HorizontalOptions=&quot;FillAndExpand&quot;
                                        SelectedItem=&quot;{Binding SelectedPhoneType}&quot;/&gt;
                                &lt;Entry Text=&quot;{Binding NewPhoneNumber, Mode=TwoWay}&quot; 
                                       Grid.Column=&quot;1&quot;
                                       Placeholder=&quot;{extensions:Translate PhoneNumber}&quot;/&gt;
                            &lt;/Grid&gt;

                            &lt;!-- ADD PHONE BUTTON  --&gt;
                            &lt;Button Margin=&quot;{StaticResource ActionButtonMargin}&quot; 
                                Style=&quot;{StaticResource ActionButton}&quot; 
                                Text=&quot;{extensions:Translate Add}&quot;
                                Command=&quot;{Binding AddPhoneNumberCommand}&quot; 
                                CommandParameter=&quot;{Binding Model.Id}&quot;  
                                IsEnabled=&quot;{Binding IsAddPhoneButtonEnabled}&quot;/&gt;

                        &lt;/StackLayout&gt;
                    &lt;/controls:CardView&gt;</span>

                &lt;/StackLayout&gt;
            &lt;/ListView.Header&gt; 
........
</pre>

 <p>And we will add the view-model codes to the <strong>PeopleViewModel.cs</strong></p>
 
 
 <pre lang="cs">public List&lt;string&gt; PhoneTypes { get; } = Enum.GetNames(typeof(PhoneType)).ToList();
public ICommand AddPhoneNumberCommand =&gt; new Command&lt;int&gt;(async personId =&gt; await AddPhoneNumberAsync(personId) , _ =&gt; IsAddPhoneButtonEnabled);

private string _selectedPhoneType = PhoneType.Mobile.ToString();
public string SelectedPhoneType
{
    get =&gt; _selectedPhoneType;
    set
    {
        _selectedPhoneType = value;
        RaisePropertyChanged(() =&gt; SelectedPhoneType);
    }
}

private async Task AddPhoneNumberAsync(int personId)
{
	var input = new AddPhoneInput
	{
		Number = NewPhoneNumber,
		PersonId = personId,
		Type = (PhoneType)Enum.Parse(typeof(PhoneType), SelectedPhoneType)
	};

	if (!Validate(input))
	{
		return;
	}

	await SetBusyAsync(async () =&gt;
	{
		var phone = await _personAppService.AddPhone(input);
		Model.Phones.Add(phone);
		NewPhoneNumber = &quot;&quot;;
		RaisePropertyChanged(() =&gt; Model.Phones);
	});
}
 </pre>
 


<h5>Deleting Phone Number</h5>
<p>To delete a phone number, we put a delete button in <b>ListView</b> <b>
ItemTemplate</b>. Button is <b>Iconize</b> button. This control uses font 
awesome to create an icon button. The only disadvantage of the control is; 
you cannot use text and icon at the same time! For more information about 
iconize library you can checkout
	<a href="https://github.com/jsmarcus/Xamarin.Plugins/tree/master/Iconize/">
	https://github.com/jsmarcus/Xamarin.Plugins/tree/master/Iconize/</a>. </p>
<p>Add the below namespace to the <b>ContentPage</b> tag in <b>
PersonDetailsView.xaml</b></p>
<pre lang="cs">
&lt;ContentPage ....
             <span style="background-color: #FFFF00">xmlns:iconize=&quot;clr-namespace:FormsPlugin.Iconize;assembly=FormsPlugin.Iconize&quot;</span>
             ....&gt;
</pre>
<p>Add delete button after phone number label as highlighted below;</p>
<pre lang="cs">
&lt;ListView.ItemTemplate&gt;
	&lt;DataTemplate&gt;
		&lt;ViewCell&gt;
			&lt;StackLayout Orientation=&quot;Horizontal&quot; BackgroundColor=&quot;White&quot; Padding=&quot;10,0,10,0&quot; &gt;
				&lt;Label Text=&quot;{Binding Type}&quot; VerticalOptions=&quot;Center&quot; FontAttributes=&quot;Bold&quot;/&gt;
				&lt;Label Text=&quot;{Binding Number}&quot; Style=&quot;{StaticResource ActiveLabel}&quot; VerticalOptions=&quot;Center&quot;/&gt;
<span style="background-color: #FFFF00">				&lt;iconize:IconButton  Margin=&quot;3&quot;
							Command=&quot;{Binding Source={x:Reference PersonDetailsPage}, Path=BindingContext.DeletePhoneNumberCommand}&quot;
							CommandParameter=&quot;{Binding .}&quot;
							Text=&quot;fa-trash&quot; 
							TextColor=&quot;White&quot;
							BackgroundColor=&quot;Red&quot;
							HeightRequest=&quot;{StaticResource SmallActionButtonSize}&quot;
							WidthRequest=&quot;{StaticResource SmallActionButtonSize}&quot;
							VerticalOptions=&quot;CenterAndExpand&quot;            
							HorizontalOptions=&quot;EndAndExpand&quot;&gt;
				&lt;/iconize:IconButton&gt;</span>
			&lt;/StackLayout&gt;
		&lt;/ViewCell&gt;
	&lt;/DataTemplate&gt;
&lt;/ListView.ItemTemplate&gt;
</pre>The text of button is <b>fa-trash</b>. This is a font-awesome text. You can find 
other font-awesome icons here
<a href="http://fontawesome.io/icons/">http://fontawesome.io/icons/</a>

<p>The command property of <b>IconButton</b> is a bit different then usual 
binding. The reason is <b>DeletePhoneNumberCommand</b> is not in <b>
	PhoneInPersonListDto</b>. But it&#39;s a root property located in viiew-model. 
That&#39;s why we set <b>Source</b> of command to <b>PersonDetailsPage</b> and
	<b>Path</b> to <b>BindingContext.DeletePhoneNumberCommand</b>. Setting <b>
	CommandParameter</b> to<b> &quot;.&quot;</b> refers to <b>PhoneInPersonListDto</b>. So 
we&#39;ll be sending <b>PhoneInPersonListDto</b> as parameter to <b>
	DeletePhoneNumberCommand</b> in the view-model.<br>
Let&#39;s create <b>DeletePhoneNumberCommand</b> in the view model. Open <b>
PersonDetailsViewModel.cs </b>and add the below code;</p>
<pre lang="cs">
public ICommand DeletePhoneNumberCommand =&gt; new Command&lt;PhoneInPersonListDto&gt;(async phone =&gt; await DeletePhoneNumberAsync(phone));

private async Task DeletePhoneNumberAsync(PhoneInPersonListDto phone)
{
	await SetBusyAsync(async () =&gt;
	{
		await _personAppService.DeletePhone(new EntityDto&lt;long&gt;(phone.Id));
		Model.Phones.Remove(phone);
	});
}

</pre>

<p>The delete button will look like below</p>
<img class="img-thumbnail" alt="Delete Phone Numbers" src="images/xamarin-phonebook-phones-delete.png"/>


<p>&nbsp;</p>
<p>Congratulations! You have completed all the steps.</p>
<h3>Conclusion</h3><p>In this document, we built a complete example that covers 
most parts of the ASP.NET Zero Xamarin development. We intentionally used 
different approaches for similar tasks to show you different styles of 
development. AspNet Zero provides an architecture but does not restrict you. The 
view designs, order of development steps and dealing with implementation may 
change <span class=""><span id="result_box1" class="short_text" lang="en">
according to the </span><span id="result_box1" class="short_text">developer.</span></span></p>
<h4>Source Code</h4><p>You should <a href="/Prices">
purchase</a> ASP.NET Zero in order to get
the source code. After purchasing, you can get this sample project source code 
from the private <a href="https://github.com/aspnetzero/aspnet-zero-samples">
Github repository</a>.</p></body></html>